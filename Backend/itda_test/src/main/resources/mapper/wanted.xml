<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.wanted">

	<select id="getWantedAll" resultType="java.lang.String">
		select wid from wanted_t
		order by startdate asc
	</select>

	<select id="getCompanyId" parameterType="java.lang.String"
		resultType="java.lang.String">
		select cid from wanted_t where wid = #{wid}
	</select>

	<select id="getWantedInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Wanted">
		select wid, wantedtitle, active, startdate, enddate,
		vcnt,
		cid, detail
		from wanted_t where wid = #{wid}
	</select>

	<select id="getCompanyInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Company">
		select cid, corpnm, totpsncnt, busisize, yrsalesamt,
		corpaddr, homepg, busicont, logo
		from company_t where cid = #{cid}
	</select>

	<select id="getWantedByRecent" resultType="java.lang.String">
		select wid from
		wanted_t where active = 1 order by startdate desc limit 24
	</select>

	<select id="getWantedByCloseEnd" resultType="java.lang.String">
		select wid from
		wanted_t where active = 1 and enddate >= now() order by enddate asc
		limit 10
	</select>

	<select id="getWantedByView" resultType="java.lang.String">
		select wid from wanted_t
		where active = 1 order by vcnt desc limit 10
	</select>

	<select id="isScraped"
		parameterType="com.ssafy.itda.itda_test.model.Scrap"
		resultType="com.ssafy.itda.itda_test.model.Scrap">
		select uid, wid from scrap_t where uid= #{uid} and wid =
		#{wid}
	</select>

	<insert id="scrap"
		parameterType="com.ssafy.itda.itda_test.model.Scrap">
		insert into scrap_t(uid, wid) values(#{uid}, #{wid})
	</insert>

	<delete id="unScrap"
		parameterType="com.ssafy.itda.itda_test.model.Scrap">
		delete from scrap_t where uid = #{uid} and wid = #{wid}
	</delete>

	<insert id="createWanted"
		parameterType="com.ssafy.itda.itda_test.model.Wanted">
		insert into wanted_t(wid, wantedtitle, active,
		startdate, enddate, cid, detail, jobType)
		values(#{wid}, #{wantedtitle},
		#{active}, from_unixtime(#{startdate}),
		from_unixtime(#{enddate}),
		#{cid}, #{detail}, #{jobType})
	</insert>

	<!-- <select id="getInputWanted" parameterType="com.ssafy.itda.itda_test.model.Wanted" -->
	<!-- resultType="java.lang.String"> -->
	<!-- SELECT WID FROM WANTED_T WHERE WANTEDTITLE = #{wantedTitle} AND STARTDATE 
		= #{startDate} -->
	<!-- AND ENDDATE = #{endDate} AND CID = #{cid} ORDER BY WID DESC LIMIT 1 -->
	<!-- </select> -->

	<delete id="deleteWanted" parameterType="java.lang.String">
		delete from wanted_t
		where wid = #{wid}
	</delete>

	<insert id="updateWanted"
		parameterType="com.ssafy.itda.itda_test.model.Wanted">
		update wanted_t set wantedtitle = #{wantedtitle},
		startdate = #{startdate}, enddate = #{enddate},
		detail = #{detail}, cid
		= #{cid} where wid = #{wid}
	</insert>

	<select id="getStackInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Stack">
		select s.sid, s.tname
		from wantedstack_t as ws join stack_t
		as
		s on ws.sid = s.sid
		where ws.wid = #{wid}
	</select>

	<select id="getWantedStackInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Stack">
		select distinct s.sid, s.tname
		from wanted_t as w, wantedstack_t as ws, stack_t as s
		where w.wid = ws.wid and ws.sid = s.sid and w.wid = #{wid}
	</select>

	<select id="getWantedByStack" parameterType="java.lang.Integer"
		resultType="java.lang.String">
		select distinct w.wid from mystack_t as ms, wantedstack_t
		as ws, wanted_t as w
		where ms.uid = #{uid} and ms.sid = ws.sid order by
		enddate limit 10
	</select>

	<select id="getWantedByScrap" parameterType="java.lang.Integer"
		resultType="java.lang.String">
		SELECT W.WID FROM SCRAP_T AS S, WANTED_T AS W
		WHERE S.UID =
		#{uid} AND S.WID = W.WID ORDER BY ENDDATE LIMIT 10
	</select>

	<update id="updateVcnt" parameterType="java.lang.String">
		UPDATE WANTED_T SET VCNT =
		VCNT + 1 WHERE WID = #{wid}
	</update>

	<update id="updateCheckExpire">
		UPDATE WANTED_T SET ACTIVE = 0 WHERE ENDDATE &lt;
		NOW()
	</update>

	<update id="updateCheckOpen">
		UPDATE WANTED_T SET ACTIVE = 1 WHERE STARTDATE &gt;
		NOW()
	</update>

	<select id="getWantedBySearch"
		parameterType="java.lang.String"
		resultType="java.lang.String">
		SELECT 
		    CORPNM, WANTEDTITLE, TNAME
		FROM
		    WANTED_T AS W
		        LEFT JOIN
		    WANTEDSTACK_T AS WS ON W.WID = WS.WID
		        LEFT JOIN
		    COMPANY_T AS C ON W.CID = C.CID
		        LEFT JOIN
		    STACK_T AS S ON WS.SID = S.SID
		WHERE
		    CORPNM LIKE '%{keyword}%'
		        OR WANTEDTITLE LIKE '%{keyword}%'
		        OR MATCH (TNAME) AGAINST ('{keyword}' )
		        OR MATCH (WANTEDTITLE) AGAINST ('{keyword}' )
	</select>
</mapper>

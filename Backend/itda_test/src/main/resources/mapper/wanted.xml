<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.wanted">

	<select id="getWantedAll" resultType="java.lang.String">
		SELECT WID FROM WANTED_T
		ORDER BY STARTDATE ASC
	</select>

	<select id="getCompanyId" parameterType="java.lang.String"
		resultType="java.lang.String">
		SELECT CID FROM WANTED_T WHERE WID = #{wid}
	</select>

	<select id="getWantedInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Wanted">
		SELECT WID, WANTEDTITLE, ACTIVE, STARTDATE, ENDDATE,
		PROCESS, ETC, QUESTION, VCNT, CID
		FROM WANTED_T WHERE WID = #{wid}
	</select>

	<select id="getCompanyInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Company">
		SELECT CID, CORPNM, TOTPSNCNT, BUSISIZE, YRSALESAMT,
		CORPADDR, HOMEPG, BUSICONT, LOGO
		FROM COMPANY_T WHERE CID = #{cid}
	</select>

	<select id="getWantedByRecent" resultType="java.lang.String">
		SELECT WID FROM
		WANTED_T WHERE ACTIVE = 1 ORDER BY STARTDATE DESC LIMIT 24
	</select>

	<select id="getWantedByCloseEnd" resultType="java.lang.String">
		SELECT WID FROM
		WANTED_T WHERE ACTIVE = 1 AND ENDDATE >= NOW() ORDER BY ENDDATE ASC
		LIMIT 10
	</select>

	<select id="getWantedByView" resultType="java.lang.String">
		SELECT WID FROM WANTED_T
		WHERE ACTIVE = 1 ORDER BY VCNT DESC LIMIT 10
	</select>

	<select id="isScraped"
		parameterType="com.ssafy.itda.itda_test.model.Scrap"
		resultType="com.ssafy.itda.itda_test.model.Scrap">
		SELECT UID, WID FROM SCRAP_T WHERE UID= #{uid} AND WID =
		#{wid}
	</select>

	<insert id="scrap"
		parameterType="com.ssafy.itda.itda_test.model.Scrap">
		INSERT INTO SCRAP_T(UID, WID) VALUES(#{uid}, #{wid})
	</insert>

	<delete id="unScrap"
		parameterType="com.ssafy.itda.itda_test.model.Scrap">
		DELETE FROM SCRAP_T WHERE UID = #{uid} AND WID = #{wid}
	</delete>

	<insert id="createWanted"
		parameterType="com.ssafy.itda.itda_test.model.Wanted">
		INSERT INTO WANTED_T(WANTEDTITLE, STARTDATE, ENDDATE,
		PROCESS, ETC, QUESTION, CID)
		VALUES(#{wantedTitle}, #{startDate},
		#{endDate}, #{process}, #{etc}, #{question}, #{cid})
	</insert>

	<select id="getInputWanted" parameterType="com.ssafy.itda.itda_test.model.Wanted"
		resultType="java.lang.String">
		SELECT WID FROM WANTED_T WHERE WANTEDTITLE = #{wantedTitle} AND STARTDATE = #{startDate}
		AND ENDDATE = #{endDate} AND CID = #{cid} ORDER BY WID DESC LIMIT 1
	</select>

	<delete id="deleteWanted" parameterType="java.lang.String">
		DELETE FROM WANTED_T
		WHERE WID = #{wid}
	</delete>

	<insert id="updateWanted"
		parameterType="com.ssafy.itda.itda_test.model.Wanted">
		INSERT INTO WANTED_T(WANTEDTITLE, STARTDATE, ENDDATE,
		PROCESS, ETC, QUESTION, CID)
		VALUES(#{wantedTitle}, #{startDate},
		#{endDate}, #{process}, #{etc}, #{question}, #{cid})
	</insert>

	<select id="getStackInfo" parameterType="java.lang.String"
		resultType="com.ssafy.itda.itda_test.model.Stack">
		SELECT S.SID, S.TNAME
		FROM WANTEDSTACK_T AS WS JOIN STACK_T AS
		S ON WS.SID = S.SID
		WHERE WS.WID = #{wid}
	</select>

	<select id="getWantedStackInfo"
	parameterType="java.lang.String"
	resultType="com.ssafy.itda.itda_test.model.Stack">
	SELECT DISTINCT S.SID, S.TNAME
	FROM WANTED_T AS W, WANTEDSTACK_T AS WS, STACK_T AS S
	WHERE W.WID = WS.WID AND WS.SID = S.SID AND W.WID = #{wid}
	</select>
	
	<select id="getWantedByStack" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT DISTINCT W.WID FROM MYSTACK_T AS MS, WANTEDSTACK_T AS WS, WANTED_T AS W
		WHERE MS.UID = #{uid} AND MS.SID = WS.SID ORDER BY ENDDATE LIMIT 10;
	</select>
	
	<select id="getWantedByScrap" parameterType="java.lang.Integer" resultType="java.lang.String">
		SELECT W.WID FROM SCRAP_T AS S, WANTED_T AS W
		WHERE S.UID = #{uid} AND S.WID = W.WID ORDER BY ENDDATE LIMIT 10;
	</select>
	
	<update id="updateVcnt" parameterType="java.lang.String">
		UPDATE WANTED_T SET VCNT = VCNT + 1 WHERE WID = #{wid}
	</update>
	
	<update id="updateCheckExpire">
		UPDATE WANTED_T SET ACTIVE = 0 WHERE ENDDATE &lt; NOW()
	</update>
	
	<update id="updateCheckOpen">
		UPDATE WANTED_T SET ACTIVE = 1 WHERE STARTDATE &gt; NOW()
	</update>
	
</mapper>
